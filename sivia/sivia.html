<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manos Unidas</title>
  <link rel="shortcut icon" href="../assets/AprenderesLogo.ico" type="image/x-icon">

      <style>
        :root{
    --bg-1:#1f0b0b; --bg-2:#ff8a3d; --bg-3:#acc43a;
    --accent-yellow:#ffcf7b; --accent-orange:#ff8a3d; --accent:#ffb86b;
    --card-bg: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.28));
    --radius:14px;
  }
  nav{position:sticky; top:14px; z-index:50; display:flex; justify-content:space-between; align-items:center;
      padding:12px 22px; margin:0 18px; border-radius:12px;
      background: linear-gradient(180deg, rgba(0,0,0,0.28), rgba(0,0,0,0.14));
      box-shadow: 0 6px 30px rgba(0,0,0,0.55); backdrop-filter: blur(6px);}
  .brand{display:flex; gap:12px; align-items:center; text-decoration:none; color:inherit}
  .logo { width:42px; height:42px; border-radius:10px;
          display:flex; align-items:center; justify-content:center; font-weight:800; color:#101010;}
  .menu{display:flex; gap:18px; align-items:center}
  .menu a{color:inherit; text-decoration:none; font-weight:600; position:relative; padding:6px 4px}
  .menu a::after{content:""; position:absolute; left:0; bottom:-6px; height:3px; width:0; border-radius:999px;
                 background: linear-gradient(90deg,var(--accent-yellow),var(--accent-orange)); transition:width .22s}
  .menu a:hover::after{width:100%}

  .hamburger{display:none; background:transparent; border:0; color:inherit; font-size:22px}
  @media (max-width:880px){ .menu{display:none} .hamburger{display:block} }

body {
  margin: 0;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  color: #fff;
  -webkit-font-smoothing: antialiased;
  
  /* Page layout: column so main can expand and footer stays at bottom */
  display: flex;
  flex-direction: column;

  /* Fondo lineal simple y fijo: extremadamente estable al zoom */
  background: linear-gradient(180deg, var(--bg-1), var(--bg-2) 45%, var(--bg-3));
  background-attachment: fixed; /* ancla al viewport */
  background-repeat: no-repeat;
  background-size: cover;
  min-height: 100vh;
  
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  z-index: -1;
  pointer-events: none;

  /* Overlay muy sutil para dar profundidad sin moverse */
  background: linear-gradient(120deg, rgba(255,204,123,0.02), rgba(255,84,84,0.01));
  backdrop-filter: blur(8px) saturate(1);
  animation: none;
  background-attachment: fixed;
}

nav{position:sticky; top:14px; z-index:50; display:flex; justify-content:space-between; align-items:center;
      padding:12px 22px; margin:0 18px; border-radius:12px;
      background: linear-gradient(180deg, rgba(0,0,0,0.28), rgba(0,0,0,0.14));
      box-shadow: 0 6px 30px rgba(0,0,0,0.55); backdrop-filter: blur(6px);}

   
  h1{font-size:44px; line-height:1.02; margin:18px 0 12px; font-weight:800; text-shadow: 0 16px 40px rgba(0,0,0,0.6)}

  .siviaMain{padding:1rem; 
            max-width:900px; 
            margin:1rem auto;
          }

  #chat{border:1px solid #ddd; padding:1rem; height:400px; overflow:auto; background-color: #101010; color:#ffffff; border-radius:5%;}
    </style>



</head>
<body>
     <nav>
  <a class="brand" href="index.html"><img src="../assets/LogoMU.png" alt="" class="logo"><div style="font-weight:800">MANOS UNIDAS</div></a>
    <div class="menu" id="menu">
      <a href="../index.html">Inicio</a>
      <a href="../proyectos.html">Proyectos</a>
      <a href="../sivia/sivia.html">Sivia</a>
      <a href="../podcast.html">Podcast</a>
      <a href="../documentos.html">Nuestros documentos</a>
      <a href="../loUltimo.html">Lo último</a>
      <a href="../propuestas.html">Propuestas</a>
    </div>
  </nav>
  <main style="padding:1rem; max-width:900px; margin:1rem auto;">
    <h1>S.I.V.I.A</h1>
    <div id="chat">
      <div id="messages"></div>
    </div>
    <form id="chatForm" style="display:flex; gap:.5rem; margin-top:.5rem;">
      <input id="prompt" type="text" placeholder="Escribe aquí..." style="flex:1; padding:.5rem;" />
      <button type="submit" style="padding:.5rem 1rem;">Enviar</button>
    </form>
    <p style="font-size:.9rem; color:#666; margin-top:.5rem;">Nota: el chat envía tus mensajes al servidor backend para generar respuestas usando la API de SIVIA.</p>
  </main>

  <script>
    const messagesEl = document.getElementById('messages')
    const form = document.getElementById('chatForm')
    const promptInput = document.getElementById('prompt')

    function escapeHtml(unsafe) {
      return unsafe
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // Render simple Markdown-like bold (**text**) and italics (*text*) safely.
    function renderMessageText(text) {
      if (!text) return ''
      // escape HTML first to avoid XSS
      let s = escapeHtml(text)
      // bold: **text** -> <strong>text</strong>
      s = s.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
      // italics: *text* -> <em>text</em> (avoid conflict with bold)
      s = s.replace(/\*(?!\*)(.+?)\*(?!\*)/g, '<em>$1</em>')
      // convert newlines to <br>
      s = s.replace(/\n/g, '<br>')
      return s
    }

    function appendMessage(author, text){
      const div = document.createElement('div')
      div.style.marginBottom = '0.6rem'
      const rendered = renderMessageText(text)
      div.innerHTML = `<strong>${escapeHtml(author)}:</strong> <span>${rendered}</span>`
      messagesEl.appendChild(div)
      messagesEl.parentElement.scrollTop = messagesEl.parentElement.scrollHeight
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault()
      const prompt = promptInput.value.trim()
      if(!prompt) return
      appendMessage('Tú', prompt)
      promptInput.value = ''
      appendMessage('SIVIA', 'Escribiendo...')
      try{
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({prompt})
        })
        const data = await res.json()
        // quitar el 'Escribiendo...'
        messagesEl.lastChild.remove()
        if(data.reply) appendMessage('SIVIA', data.reply)
        else appendMessage('SIVIA', data.error || 'Error en la respuesta')
      }catch(err){
        messagesEl.lastChild.remove()
        appendMessage('SIVIA', 'Error de conexión con el servidor')
      }
    })
  </script>
</body>
</html>
